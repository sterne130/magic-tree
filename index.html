<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wishful winter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- 1. 基础设置 --- */
        body { margin: 0; overflow: hidden; background: #050103; font-family: 'Helvetica Neue', 'Segoe UI', sans-serif; }
        #canvas-container { position: absolute; width: 100%; height: 100%; z-index: 1; }
        .mirror { transform: scaleX(-1); }

        /* --- 2. 文艺感标题设计 (本次修改的核心) --- */
        .artistic-title {
            font-family: Georgia, 'Times New Roman', serif; /* 衬线字体 */
            font-style: italic; /* 斜体 */
            font-weight: 400; 
            letter-spacing: 0.02em; /* 紧凑间距 */
            text-transform: lowercase; 
            /* 柔和流光 */
            background: linear-gradient(90deg, #ffb6c1, #ffffff, #ffb6c1);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 6s linear infinite;
            filter: drop-shadow(0 0 10px rgba(255, 105, 180, 0.5));
        }
        
        @keyframes shimmer {
            to { background-position: 200% center; }
        }

        /* 呼吸灯点 */
        .status-dot {
            width: 4px; height: 4px;
            background-color: #ff69b4;
            border-radius: 50%;
            box-shadow: 0 0 8px #ff69b4, 0 0 12px #ff1493;
            animation: breathe 3s infinite ease-in-out;
            opacity: 0; transition: opacity 1s 1s;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.4); opacity: 1; }
        }

        /* --- 3. 加载层样式 --- */
        #loading-overlay {
            position: fixed; inset: 0; background: #050103; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1.2s ease-out;
        }
        .loader-ring {
            width: 50px; height: 50px;
            border: 2px solid rgba(255, 105, 180, 0.1);
            border-top: 2px solid #ff69b4;
            border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 30px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>

    <!-- Import Map (保持原样，千万别动) -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
            "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/+esm"
        }
    }
    </script>
</head>
<body>

    <!-- 加载层：应用新字体 -->
    <div id="loading-overlay">
        <div class="loader-ring"></div>
        <!-- 这里用了新的 class: artistic-title -->
        <h1 class="artistic-title text-2xl">loading magic...</h1>
        <div class="text-white/30 text-xs mt-4 font-mono tracking-widest" id="status-text">initializing ai core</div>
        
        <!-- 错误提示区 -->
        <div id="error-msg" class="hidden mt-6 text-red-400 text-xs tracking-widest border-b border-red-900 pb-1">connection failed</div>
        
        <button id="start-btn" class="hidden mt-8 px-12 py-3 border border-pink-500/30 text-pink-300 hover:bg-pink-500/10 hover:text-white transition-all rounded-sm text-xs tracking-[0.3em] uppercase duration-500">
            Enter
        </button>
    </div>

    <!-- 主界面：应用新字体和布局 -->
    <div class="fixed top-8 left-8 z-10 pointer-events-none select-none mix-blend-screen">
        <h1 class="artistic-title text-4xl md:text-5xl">wishful winter</h1>
        <!-- 装饰线 + 呼吸点 -->
        <div class="flex items-center mt-2 opacity-80">
            <div class="w-12 h-[1px] bg-gradient-to-r from-pink-400/50 to-transparent"></div>
            <div id="live-dot" class="status-dot -ml-1"></div>
        </div>
    </div>

    <!-- 摄像头盒子 -->
    <div id="cam-box" class="fixed bottom-6 right-6 w-32 h-24 sm:w-40 sm:h-28 border border-white/10 rounded overflow-hidden bg-black/80 z-40 hidden shadow-[0_0_30px_rgba(255,105,180,0.1)]">
        <video id="webcam" autoplay playsinline class="w-full h-full object-cover mirror opacity-30 mix-blend-lighten grayscale"></video>
        <canvas id="output_canvas" class="absolute inset-0 w-full h-full object-cover mirror"></canvas>
    </div>

    <div id="canvas-container"></div>

    <!-- 
      JavaScript 逻辑部分 
      (完全复制于您提供的“能运行版”，没有任何逻辑修改) 
    -->
    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { FilesetResolver, HandLandmarker, DrawingUtils } from '@mediapipe/tasks-vision';

        const CONFIG = {
            colors: { bg: 0x050103, pinkMain: 0xFF69B4, pinkGlow: 0xFF1493 },
            counts: { leavesPink: 3600, leavesWhite: 400, ribbon: 1200 }
        };

        // 注意：这里需要确保 ID 对应正确。我检查了上面的 HTML，ID 都是对的。
        const ui = {
            status: document.getElementById('status-text'),
            startBtn: document.getElementById('start-btn'),
            error: document.getElementById('error-msg'),
            overlay: document.getElementById('loading-overlay'),
            loader: document.querySelector('.loader-ring'),
            liveDot: document.getElementById('live-dot')
        };

        // --- 1. AI 自动初始化 ---
        let handLandmarker = undefined;

        async function initAI() {
            try {
                // 这里的 ./ 非常关键，确保 github 仓库里有 fileset 的 wasm 文件
                const vision = await FilesetResolver.forVisionTasks("./");
                handLandmarker = await HandLandmarker.createFromOptions(vision, {
                    baseOptions: {
